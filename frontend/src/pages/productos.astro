---
// **VERIFICA ESTE NOMBRE:** Asegúrate de que 'MainLayout.astro' es el nombre correcto de tu layout principal.
// Si tu layout principal se llama 'Layout.astro' (sin "Main"), cámbialo a:
// import Layout from '../layouts/Layout.astro';
import MainLayout from '../layouts/MainLayout.astro';
import ProductCard from '../components/ProductCard.astro';
import CategoryFilter from '../components/CategoryFilter.astro'; // <-- ¡NUEVO! Importamos el filtro

// --- LÓGICA DE FILTRADO (Simulado) ---
// Obtenemos la categoría seleccionada de los parámetros de la URL
const url = new URL(Astro.request.url);
const selectedCategory = url.searchParams.get('category') || '';

// Datos de productos de prueba (mock data)
// ¡¡ACTUALIZA imageUrl CON LOS NOMBRES DE TUS FOTOS REALES!!
const allProducts = [
  { id: 1, title: 'Camiseta de Fútbol Clásica', category: 'Camisetas', price: 29.99, imageUrl: '/src/assets/camiseta-barcelona.jpg' }, // EJEMPLO: USA TU NOMBRE DE ARCHIVO
  { id: 2, title: 'Jeans Slim Fit Azules', category: 'Pantalones', price: 45.50, imageUrl: '/src/assets/Jeans-azul.png', discountPercentage: 10 },
  { id: 3, title: 'Sudadera con Capucha Cómoda', category: 'Sudaderas', price: 35.00, imageUrl: '/src/assets/sudadera-capucha.png' },
  { id: 4, title: 'Zapatillas Adidas Yeezy Boost', category: 'Calzado', price: 69.95, imageUrl: '/src/assets/Zapatillas-Adidas-Yeezy-Boost.png', discountPercentage: 25 },
  { id: 5, title: 'Vestido de Verano Floral', category: 'Vestidos', price: 52.75, imageUrl: '/src/assets/Vestido de Verano Floral.jpg' },
  { id: 6, title: 'Gorra de Béisbol Negra', category: 'Accesorios', price: 12.00, imageUrl: '/src/assets/Gorra de Béisbol Negra.jpg' },
  { id: 7, title: 'Chaqueta de Cuero Elegante', category: 'Chaquetas', price: 120.00, imageUrl: '/src/assets/Chaqueta de Cuero Elegante.jpg', discountPercentage: 15 },
  { id: 8, title: 'Falda Midi Plisada', category: 'Faldas', price: 38.25, imageUrl: '/src/assets/Falda Midi Plisada.jpg' },
  // Añade más productos si quieres, y asegúrate de darles una 'category'
];

// Obtenemos una lista única de categorías para el filtro
const categories = Array.from(new Set(allProducts.map(p => p.category)));

// Filtramos los productos según la categoría seleccionada
const filteredProducts = selectedCategory
  ? allProducts.filter(product => product.category === selectedCategory)
  : allProducts;

// --- DETERMINAR SI ES UNA PETICIÓN HTMX ---
// Si la cabecera 'HX-Request' está presente, significa que la petición viene de HTMX
const isHxRequest = Astro.request.headers.get('HX-Request') === 'true';

// Si es una petición HTMX, solo devolvemos la cuadrícula de productos, no el layout completo
// Esto es CRÍTICO para HTMX: solo actualiza la parte de la página que cambia
if (isHxRequest) {
  return Astro.html`
    <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 p-4 sm:p-8 max-w-7xl mx-auto">
      ${filteredProducts.length > 0 ? filteredProducts.map(product => Astro.renderComponent(ProductCard, {
          title: product.title,
          price: product.price,
          imageUrl: product.imageUrl,
          discountPercentage: product.discountPercentage
      })) : '<p class="text-center text-gray-600 col-span-full">No se encontraron productos en esta categoría.</p>'}
    </div>
  `;
}
---

<MainLayout title="Catálogo de Productos - StyleHub">
  <h1 class="text-4xl sm:text-5xl font-extrabold text-center my-10 text-gray-900 leading-tight">
    Explora Nuestra Colección
  </h1>
  <p class="text-center text-gray-600 mb-12 max-w-2xl mx-auto">
    Descubre las últimas tendencias y encuentra tu estilo ideal en nuestra amplia selección de ropa.
  </p>

  <div class="max-w-7xl mx-auto px-4 sm:px-8">
    <CategoryFilter categories={categories} selectedCategory={selectedCategory} />
  </div>

  <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 p-4 sm:p-8 max-w-7xl mx-auto">
    {filteredProducts.length > 0 ? filteredProducts.map(product => (
      <ProductCard
        title={product.title}
        price={product.price}
        imageUrl={product.imageUrl}
        discountPercentage={product.discountPercentage}
      />
    )) : <p class="text-center text-gray-600 col-span-full">No se encontraron productos en esta categoría.</p>}
  </div>
</MainLayout>